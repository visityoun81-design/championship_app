<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHAMPIONSHIP - LOGIN</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary-purple: #a855f7; --dark-bg: #0f172a; --glass-bg: rgba(255, 255, 255, 0.05); --input-bg: rgba(0, 0, 0, 0.3); }
        body { margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; background: radial-gradient(circle at top, #1e1b4b, #020617); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow-x: hidden; }
        .login-container { width: 90%; max-width: 400px; padding: 40px 20px; background: var(--glass-bg); backdrop-filter: blur(10px); border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); text-align: center; }
        .logo-text { font-size: 2rem; font-weight: 900; letter-spacing: 4px; background: linear-gradient(to right, #d8b4fe, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 30px; text-transform: uppercase; }
        .role-selector { display: flex; background: var(--input-bg); border-radius: 12px; margin-bottom: 25px; padding: 4px; }
        .role-btn { flex: 1; padding: 10px; border: none; background: transparent; color: #94a3b8; cursor: pointer; font-weight: bold; transition: 0.3s; border-radius: 10px; }
        .role-btn.active { background: var(--primary-purple); color: white; }
        .input-group { text-align: left; margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.8rem; color: #a855f7; margin-bottom: 8px; margin-left: 5px; }
        input { width: 100%; padding: 14px; box-sizing: border-box; background: var(--input-bg); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; color: white; font-size: 1rem; outline: none; }
        input:focus { border-color: var(--primary-purple); box-shadow: 0 0 10px rgba(168, 85, 247, 0.2); }
        .btn-login { width: 100%; padding: 15px; background: linear-gradient(135deg, #a855f7, #7e22ce); border: none; border-radius: 12px; color: white; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 10px; box-shadow: 0 10px 15px -3px rgba(168, 85, 247, 0.4); }
        .btn-request { display: block; margin-top: 20px; color: #94a3b8; text-decoration: none; font-size: 0.9rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="login-container">
    <div class="logo-text">CHAMPIONSHIP</div>

   <div class="role-selector">
    <button type="button" class="role-btn active" onclick="setRole('학생', this)">학생</button>
    <button type="button" class="role-btn" onclick="setRole('선생님', this)">선생님</button>
</div>

    <form id="loginForm" onsubmit="event.preventDefault(); login();">
        <div class="input-group">
            <label>아이디</label>
            <input type="text" id="login-id" placeholder="아이디를 입력해 주세요" required>
        </div>
        <div class="input-group">
            <label>비밀번호</label>
            <input type="password" id="login-pw" placeholder="비밀번호를 입력해 주세요" required>
        </div>
        <button type="submit" class="btn-login">로그인 하기</button>
    </form>

    <div class="btn-request" onclick="openJoinModal()">회원가입 요청하기</div>
</div>

<div id="join-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); backdrop-filter:blur(10px); z-index:10000; justify-content:center; align-items:center;">
    <div style="background:linear-gradient(145deg, #1e293b, #0f172a); width:90%; max-width:400px; padding:30px; border-radius:24px; border:2px solid #a855f7; box-shadow:0 0 50px rgba(168,85,247,0.3);">
        <h2 style="color:#a855f7; margin-top:0; text-align:center;">JOIN REQUEST</h2>
     
          <div style="display:flex; flex-direction:column; gap:15px;">
           <div style="display:flex; gap:10px;">
            <button type="button" id="type-student" class="role-btn active" onclick="setRequestType('학생', this)">학생</button>
    <button type="button" id="type-teacher" class="role-btn" onclick="setRequestType('선생님', this)">선생님</button>
</div>
            <input type="text" id="req-name" placeholder="이름">
            <input type="text" id="req-id" placeholder="희망 아이디">
            <input type="password" id="req-pw" placeholder="비밀번호">
            <input type="tel" id="req-phone" placeholder="전화번호">
            <button class="btn-login" onclick="submitJoinRequest()">요청 보내기</button>
            <button onclick="document.getElementById('join-modal').style.display='none'" style="background:none; border:none; color:#94a3b8; cursor:pointer;">닫기</button>
        </div>
    </div>
</div>

<script>
    // [2] Firebase 설정 및 초기화
    const firebaseConfig = {
    apiKey: "AIzaSyCbhFq8vcLem8DoMdlsXpC-ZRYELhJSFHU",
    authDomain: "championship-8f923.firebaseapp.com",
    databaseURL: "https://championship-8f923-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "championship-8f923",
    storageBucket: "championship-8f923.firebasestorage.app",
    messagingSenderId: "118704807417",
    appId: "1:118704807417:web:b1cacb9636d51a38d67128",
    measurementId: "G-KLHCC95R2C"
  };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let selectedRequestType = '학생';

    // [로그인 화면용] 역할 선택
    function setRole(role, element) {
        const btns = document.querySelectorAll('.role-selector .role-btn');
        btns.forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
        console.log("선택된 로그인 역할:", role);
    }

    // [가입 모달창용] 타입 선택
    function setRequestType(type, element) {
        selectedRequestType = type;
        const modalBtns = document.querySelectorAll('#join-modal .role-btn');
        modalBtns.forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
        console.log("가입 요청 타입:", type);
    }

    function openJoinModal() { document.getElementById('join-modal').style.display = 'flex'; }

    // [회원가입 요청]
    function submitJoinRequest() {
        const name = document.getElementById('req-name').value;
        const id = document.getElementById('req-id').value;
        const pw = document.getElementById('req-pw').value;
        const phone = document.getElementById('req-phone').value;

        if(!name || !id || !pw || !phone) return alert("모든 정보를 입력해주세요!");

        db.ref('joinRequests/' + id).set({
            type: selectedRequestType,
            name: name,
            id: id,
            password: pw, 
            phone: phone,
            date: new Date().toLocaleString()
        }).then(() => {
            alert("가입 요청 완료! 선생님의 승인을 기다려주세요.");
            document.getElementById('join-modal').style.display = 'none';
        }).catch((error) => {
            alert("오류 발생: " + error.message);
        });
    } // <--- [수정] 이 중괄호가 빠져있어서 그동안 안 됐던 거예요!

    // [로그인 로직]
    function login() {
        const idInput = document.getElementById('login-id').value.trim();
        const pwInput = document.getElementById('login-pw').value.trim();
        const activeBtn = document.querySelector('.role-selector .role-btn.active');
        const roleBtn = activeBtn ? activeBtn.innerText : '학생';

        // 관리자 하이패스
        if (roleBtn === '선생님' && idInput === 'admin' && pwInput === '1234') {
            localStorage.setItem('userRole', 'admin');
            localStorage.setItem('loginId', 'admin');
            localStorage.setItem('userName', '마스터 관리자');
            location.href = "mainpage.html";
            return;
        }

        // 일반 유저 체크
        db.ref('approvedUsers/' + idInput).once('value').then((snapshot) => {
            const userData = snapshot.val();
            if (userData) {
                // 서버에 'password'로 저장되어 있는지, 'pw'로 되어있는지 꼭 확인하세요!
                if (userData.password === pwInput || userData.pw === pwInput) {
                    localStorage.setItem('userRole', 'student');
                    localStorage.setItem('loginId', idInput);
                    localStorage.setItem('userName', userData.name);
                    alert(userData.name + "님 환영합니다!");
                    location.href = "mainpage.html";
                } else { 
                    alert("비밀번호가 틀렸습니다."); 
                }
            } else { 
                alert("승인되지 않았거나 없는 아이디입니다."); 
            }
        }).catch(err => alert("오류: " + err.message));
    }
</script>

</body>
</html>
