<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHAMPIONSHIP 2026 - 실시간 전광판</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Noto+Sans+KR:wght@900&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            background: radial-gradient(circle at top, #1e1b4b, #020617);
            color: #fff; 
            font-family: 'Noto Sans KR', sans-serif; 
            overflow-y: auto;
        }
        .monitor-container { 
            min-height: 100vh; display: flex; flex-direction: column; 
            align-items: center; padding: 40px 20px; 
            box-sizing: border-box; 
        }
        .title { 
            font-family: 'Orbitron'; font-size: 3.5rem; 
            background: linear-gradient(to right, #d8b4fe, #a855f7);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(168, 85, 247, 0.4); 
            margin-bottom: 50px; letter-spacing: 12px; font-weight: 900;
        }
        .rank-board { 
            width: 100%; max-width: 1700px; 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 25px 18px; 
        }
        .rank-item { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); 
            padding: 20px 15px; 
            border-radius: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
        }
        .rank-num { 
            font-family: 'Orbitron', sans-serif; font-size: 1.3rem; font-weight: 900; 
            width: 48px; height: 48px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: #fff; background: #334155; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }
        .medal-1 { background: linear-gradient(135deg, #ffd700, #b8860b) !important; color: #000 !important; border: 2px solid #fff; box-shadow: 0 0 15px #ffd700; }
        .medal-2 { background: linear-gradient(135deg, #ff85a2, #d6336c) !important; border: 2px solid #fff; }
        .medal-3 { background: linear-gradient(135deg, #4ea8de, #0077b6) !important; border: 2px solid #fff; }
        .medal-4 { background: linear-gradient(135deg, #9d4edd, #5a189a) !important; border: 2px solid #fff; }
        .medal-5 { background: linear-gradient(135deg, #ff9100, #ff6d00) !important; border: 2px solid #fff; }

        .info-wrap { display: flex; align-items: center; justify-content: flex-end; flex-grow: 1; gap: 12px; overflow: hidden; }
        .user-name { font-size: 1.4rem; font-weight: 900; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .user-score { font-family: 'Orbitron'; font-size: 1.8rem; color: #4ade80; min-width: 60px; text-align: right; }
        .is-playing { animation: pulse-glow 1.2s infinite; border: 2px solid #a855f7 !important; background: rgba(168, 85, 247, 0.15) !important; }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 5px #a855f7; } 50% { box-shadow: 0 0 25px #a855f7; } 100% { box-shadow: 0 0 5px #a855f7; } }
    </style>
</head>
<body>
    <div class="monitor-container">
        <div class="title">LIVE CHAMPIONSHIP</div>
        <div id="rank-board" class="rank-board"></div>
    </div>

    <script>
        function updateMonitor() {
            const ranks = JSON.parse(localStorage.getItem('rank_championship') || "[]");
            
            // [수정] 정렬 로직: 1순위 점수(내림차순), 2순위 남은 시간(내림차순 - 시간이 많이 남을수록 빠름)
            ranks.sort((a, b) => {
                if (b.score !== a.score) return b.score - a.score;
                return (b.timeLeft || 0) - (a.timeLeft || 0);
            });

            const board = document.getElementById('rank-board');
            board.innerHTML = "";

            let displayRank = 0;
            let lastScore = -1;
            let lastTime = -1;

            ranks.forEach((r, i) => {
                // [수정] 순위 부여 로직: 점수와 남은 시간이 모두 같을 때만 동점 처리
                if (r.score !== lastScore || (r.timeLeft || 0) !== lastTime) {
                    displayRank++;
                }
                lastScore = r.score;
                lastTime = (r.timeLeft || 0);

                const item = document.createElement('div');
                let medalClass = "";
                if(displayRank === 1) medalClass = "medal-1";
                else if(displayRank === 2) medalClass = "medal-2";
                else if(displayRank === 3) medalClass = "medal-3";
                else if(displayRank === 4) medalClass = "medal-4";
                else if(displayRank === 5) medalClass = "medal-5";

                const isActive = r.isPlaying === true && (Date.now() - r.lastActive < 180000);
                const statusClass = isActive ? 'is-playing' : '';

                item.className = `rank-item ${statusClass}`;
                item.innerHTML = `
                    <div class="rank-num ${medalClass}">${displayRank}</div>
                    <div class="info-wrap">
                        <span class="user-name">${r.realName}</span>
                        <span class="user-score">${r.score}</span>
                    </div>
                `;
                board.appendChild(item);
            });
        }
        setInterval(updateMonitor, 1000);
        updateMonitor();
    </script>
</body>
</html>