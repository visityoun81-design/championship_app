<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHAMPIONSHIP - í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0f172a; --panel: #1e293b; --purple: #c084fc;
            --gold: #facc15; --green: #4ade80; --red: #f87171; --blue: #3b82f6;
        }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Noto Sans KR', sans-serif; padding: 10px; box-sizing: border-box; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--purple); padding-bottom: 10px; }
        h1 { font-family: 'Orbitron', sans-serif; margin: 0; color: var(--purple); font-size: 1.1rem; }
        
        section { background: var(--panel); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        h2 { font-size: 0.95rem; color: var(--purple); margin: 0 0 12px 0; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--purple); padding-left: 8px; }
        
        .btn { border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; font-size: 0.8rem; transition: 0.2s; }
        .btn-approve { background: var(--green); color: #000; }
        .btn-delete { background: var(--red); }
        .btn-blue { background: var(--blue); }
        .btn-reset { background: #334155; font-size: 0.7rem; padding: 8px 4px; }
        
       input, select { 
    background: #020617; border: 1px solid #334155; color: white; padding: 10px; 
    border-radius: 8px; font-size: 0.85rem; outline: none; 
    width: 100%; /* ë„ˆë¹„ë¥¼ 100%ë¡œ ê½‰ ì±„ìš°ê²Œ í•¨ */
    box-sizing: border-box; /* íŒ¨ë”© ë•Œë¬¸ì— ì‚ì ¸ë‚˜ê°€ì§€ ì•Šê²Œ í•¨ */
}
        
        .table-wrapper { width: 100%; overflow-x: auto; }
        .admin-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; min-width: 400px; }
        .admin-table th { border-bottom: 2px solid var(--purple); padding: 10px 5px; text-align: left; color: #94a3b8; }
        .admin-table td { padding: 10px 5px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* ê¸°ë¡ ë³´ê¸° ëª¨ë‹¬ */
        #record-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; padding: 15px;
        }
        .modal-content { background: var(--panel); width: 100%; max-width: 500px; border-radius: 20px; padding: 15px; border: 2px solid var(--purple); max-height: 90vh; overflow-y: auto; }
        
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .report-column { display: flex; flex-direction: column; gap: 5px; }
        .subject-card { background: rgba(255,255,255,0.05); padding: 8px 10px; border-radius: 6px; border-left: 3px solid var(--blue); display: flex; justify-content: space-between; align-items: center; }
        .score-val { color: var(--gold); font-weight: bold; font-size: 0.8rem; }

        .log-list { background: #020617; border-radius: 10px; padding: 10px; max-height: 150px; overflow-y: auto; font-size: 0.7rem; }
        .reset-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
    </style>
</head>
<body>

<header>
    <h1>MASTER CONTROL</h1>
    <button class="btn btn-blue" style="padding:5px 10px;" onclick="location.href='mainpage.html'">í™ˆ</button>
</header>

<div id="admin-only-top" style="display: none;">
    <section style="border: 1px solid var(--red);">
        <h2 style="color:var(--red)">ğŸ“© ê°€ì… ìŠ¹ì¸ ëŒ€ê¸°</h2>
        <div id="request-list" style="font-size: 0.8rem;"></div>
    </section>

<div id="admin-only-top" style="display: none;">
    <section style="border: 1px solid var(--red); padding: 15px; margin-bottom: 20px;">
        <h2 style="color:var(--red)">ğŸ“© ê°€ì… ìŠ¹ì¸ ëŒ€ê¸°</h2>
        <div id="request-list" style="font-size: 0.8rem;"></div>
    </section>

    <section id="admin-record-section" style="padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px; border: 1px solid #a855f7;">
        <h2 style="color: #a855f7;">ğŸ‘¤ í•™ìƒë³„ ëˆ„ì  ê¸°ë¡ ê´€ë¦¬</h2>
        <button onclick="loadAllStudentRecords()" style="padding: 10px 20px; background: #a855f7; border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 15px;">
            ê¸°ë¡ ìƒˆë¡œê³ ì¹¨ ğŸ”„
        </button>
        
        <div id="admin-record-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
            <p style="color: #94a3b8;">"ê¸°ë¡ ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
        </div>
    </section>
</div>


    <section>
        <h2>ğŸ† ì±”í”¼ì–¸ì‹­ ì»¨íŠ¸ë¡¤</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button class="btn btn-approve" onclick="alert('ëŒ€íšŒ ì‹œì‘!')">ëŒ€íšŒ ì‹œì‘</button>
            <button class="btn btn-delete" onclick="alert('ëŒ€íšŒ ì¢…ë£Œ')">ëŒ€íšŒ ì¢…ë£Œ</button>
            <button class="btn btn-blue" style="grid-column: span 2;" onclick="window.open('monitor.html', '_blank')">ğŸ–¥ï¸ ì‹¤ì‹œê°„ ì „ê´‘íŒ ëª¨ë“œ</button>
        </div>
    </section>
</div>

<section>
    <h2>â• ì‚¬ìš©ì ì§ì ‘ ë“±ë¡</h2>
    <div style="display: flex; flex-direction: column; gap: 8px;">
        <div id="reg-type-select-area" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <select id="reg-type">
                <option value="í•™ìƒ">í•™ìƒ ë“±ë¡</option>
                <option value="ì„ ìƒë‹˜">ì„ ìƒë‹˜ ë“±ë¡</option>
            </select>
            <select id="reg-teacher-select">
                <option value="ê´€ë¦¬ì">ê´€ë¦¬ì ì§ì†</option>
            </select>
        </div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom:8px;">
    <input type="text" id="reg-name" placeholder="ì„±í•¨/ì´ë¦„">
    <input type="text" id="reg-id" placeholder="ì•„ì´ë””">
</div>
        <input type="password" id="reg-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button class="btn btn-approve" onclick="directRegister()">ë“±ë¡í•˜ê¸°</button>
    </div>
</section>

<section id="teacher-list-section">
    <h2>ğŸ‘¨â€ğŸ« ì„ ìƒë‹˜ ëª…ë‹¨ <span id="teacher-count" style="font-size:0.8rem; margin-left:10px; color:var(--purple);">0ëª…</span></h2>
    <div class="table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ì„±í•¨(ID)</th>
                    <th>ë¹„ë°€ë²ˆí˜¸</th>
                    <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="teacher-list-body"></tbody>
        </table>
    </div>
</section>

<section>
    <h2>ğŸ‘¶ í•™ìƒ ëª…ë‹¨ <span id="user-count" style="font-size:0.8rem; margin-left:10px; color:var(--purple);">0ëª…</span></h2>
    <div style="display: flex; gap: 5px; margin-bottom: 10px;">
        <select id="filter-teacher" onchange="displayUserList()" style="flex: 1;">
            <option value="all">ì „ì²´ë³´ê¸°(ì „ì²´í•™ìƒ)</option>
        </select>
        <input type="text" id="search-input" onkeyup="displayUserList()" placeholder="í•™ìƒ ì´ë¦„ ê²€ìƒ‰" style="flex: 1;">
    </div>
    <div class="table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ì„±ëª…(ID)</th>
                    <th>ê¸°ë¡</th>
                    <th>ë ˆë²¨</th>
                    <th>ë‹´ë‹¹ ì„ ìƒë‹˜</th>
                    <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="user-list-body"></tbody>
        </table>
    </div>
</section>

<section id="reset-section" style="display: none;">
    <h2 style="color:var(--red)">ğŸš¨ ìˆœìœ„íŒ ì´ˆê¸°í™”</h2>
    <div class="reset-grid">
        <div class="report-column">
            <button class="btn btn-reset" onclick="resetRank('ì•”ì‚°ì±”í”¼ì–¸')">ì•”ì‚°ì±”í”¼ì–¸ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ë§ì…ˆì´ˆê¸‰')">ë§ì…ˆì´ˆê¸‰ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ë§ì…ˆì¤‘ê¸‰')">ë§ì…ˆì¤‘ê¸‰ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ë§ì…ˆë§ˆìŠ¤í„°')">ë§ì…ˆë§ˆìŠ¤í„° ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('10ë§Œë“¤ê¸°')">10ë§Œë“¤ê¸° ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('24ë§Œë“¤ê¸°')">24ë§Œë“¤ê¸° ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ìŠíƒœí‘œ')">ìŠíƒœí‘œ ë¦¬ì…‹</button>
        </div>
        <div class="report-column">
            <button class="btn btn-reset" onclick="resetRank('ê³±ì…ˆì´ˆê¸‰')">ê³±ì…ˆì´ˆê¸‰ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ê³±ì…ˆì¤‘ê¸‰')">ê³±ì…ˆì¤‘ê¸‰ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ê³±ì…ˆë§ˆìŠ¤í„°')">ê³±ì…ˆë§ˆìŠ¤í„° ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ë‚˜ëˆ—ì…ˆì´ˆê¸‰')">ë‚˜ëˆ—ì…ˆì´ˆê¸‰ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ë‚˜ëˆ—ì…ˆì¤‘ê¸‰')">ë‚˜ëˆ—ì…ˆì¤‘ê¸‰ ë¦¬ì…‹</button>
            <button class="btn btn-reset" onclick="resetRank('ë‚˜ëˆ—ì…ˆë§ˆìŠ¤í„°')">ë‚˜ëˆ—ì…ˆë§ˆìŠ¤í„° ë¦¬ì…‹</button>
            <button class="btn btn-reset" style="background:var(--gold); color:#000;" onclick="resetRank('ì „ì²´ëŒ€íšŒ')">ëŒ€íšŒì „ì²´ ë¦¬ì…‹</button>
        </div>
    </div>
</section>

<div id="record-modal">
    <div class="modal-content">
        <h2 id="modal-user-name" style="font-size:1rem; margin-top:0; color:var(--purple);">í•™ìŠµ ë¦¬í¬íŠ¸</h2>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; font-size:0.85rem;">
            <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:10px; border:1px solid #334155;">
                <span style="color:var(--blue)">ğŸ’ ë³´ì„:</span> <span id="m-gem">0</span>
            </div>
            <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:10px; border:1px solid #334155;">
                <span style="color:var(--gold)">ğŸª™ ì½”ì¸:</span> <span id="m-coin">0</span>
            </div>
            <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:10px; border:1px solid #334155; grid-column: span 2;">
                <span style="color:var(--green)">ğŸ–ï¸ íšë“ ë±ƒì§€:</span> <span id="m-badges" style="color:#fff; margin-left:5px;">ì—†ìŒ</span>
            </div>
        </div>

        <h4 style="margin: 15px 0 10px 0; font-size:0.9rem; color:var(--gold);">ğŸ† ê³¼ëª©ë³„ ìµœê³  ê¸°ë¡</h4>
        <div class="report-grid">
            <div class="report-column" id="col-1"></div>
            <div class="report-column" id="col-2"></div>
        </div>

        <h4 style="margin: 15px 0 10px 0; font-size:0.8rem; color:var(--purple);">ğŸ“œ ìµœê·¼ ì—°ìŠµ ë‚´ì—­</h4>
        <div class="log-list" id="m-log-list"></div>
        <button class="btn btn-delete" style="width:100%; margin-top:15px;" onclick="closeModal()">ë‹«ê¸°</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    // [2] Firebase ì„¤ì • (ë‚´ì¼ ì„¤ì •ê°’ì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”)
  const firebaseConfig = {
    apiKey: "AIzaSyCbhFq8vcLem8DoMdlsXpC-ZRYELhJSFHU",
    authDomain: "championship-8f923.firebaseapp.com",
    databaseURL: "https://championship-8f923-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "championship-8f923",
    storageBucket: "championship-8f923.firebasestorage.app",
    messagingSenderId: "118704807417",
    appId: "1:118704807417:web:b1cacb9636d51a38d67128",
    measurementId: "G-KLHCC95R2C"
  }

    // [3] Firebase ì—°ê²° ì‹œì‘
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    var db = firebase.database();

    // [4] ë³€ìˆ˜ ì„¤ì •
    var loginName = localStorage.getItem('userName');
    var userRole = localStorage.getItem('userRole');
    var group1 = ['ì•”ì‚°ì±”í”¼ì–¸', 'ë§ì…ˆì´ˆê¸‰', 'ë§ì…ˆì¤‘ê¸‰', 'ë§ì…ˆë§ˆìŠ¤í„°', '10ë§Œë“¤ê¸°', '24ë§Œë“¤ê¸°', 'ìŠíƒœí‘œ'];
    var group2 = ['ê³±ì…ˆì´ˆê¸‰', 'ê³±ì…ˆì¤‘ê¸‰', 'ê³±ì…ˆë§ˆìŠ¤í„°', 'ë‚˜ëˆ—ì…ˆì´ˆê¸‰', 'ë‚˜ëˆ—ì…ˆì¤‘ê¸‰', 'ë‚˜ëˆ—ì…ˆë§ˆìŠ¤í„°'];

    // [5] í™”ë©´ ì´ˆê¸°í™” (ì—¬ê¸°ì„œ ë²„íŠ¼ë“¤ì´ ë³´ì´ê³  ìˆ¨ê²¨ì§‘ë‹ˆë‹¤)
    window.onload = function() {
        var regArea = document.getElementById('reg-type-select-area');
        var regTeacherSelect = document.getElementById('reg-teacher-select');
        var adminTop = document.getElementById('admin-only-top');
        var resetSec = document.getElementById('reset-section');

        if (userRole === 'admin') {
            if(adminTop) adminTop.style.display = 'block';
            if(resetSec) resetSec.style.display = 'block';
        } else {
            if(adminTop) adminTop.style.display = 'none';
            if(resetSec) resetSec.style.display = 'none';
            if(regArea) regArea.style.display = 'none';
            if(regTeacherSelect) {
                regTeacherSelect.innerHTML = '<option value="' + loginName + '">' + loginName + '</option>';
                regTeacherSelect.value = loginName;
            }
        }
        displayUserList(); // ë¦¬ìŠ¤íŠ¸ ì‹¤í–‰
        loadJoinRequests(); // ìŠ¹ì¸ìš”ì²­ ì‹¤í–‰
    };

    // [6] í•™ìƒ/ì„ ìƒë‹˜ ëª©ë¡ ì‹¤ì‹œê°„ í‘œì‹œ
    function displayUserList() {
        db.ref('approvedUsers').on('value', function(snapshot) {
            var usersObj = snapshot.val() || {};
            var users = [];
            for(var key in usersObj) {
                var u = usersObj[key];
                u.id = key;
                users.push(u);
            }

            var filterValue = document.getElementById('filter-teacher') ? document.getElementById('filter-teacher').value : 'all';
            var search = document.getElementById('search-input') ? document.getElementById('search-input').value.toLowerCase() : "";

            // ì„ ìƒë‹˜ ê´€ë¦¬
            if (userRole === 'admin') {
                var teachers = users.filter(function(u) { return u.type === 'ì„ ìƒë‹˜'; });
                document.getElementById('teacher-count').innerText = teachers.length + "ëª…";
                document.getElementById('teacher-list-body').innerHTML = teachers.map(function(t) {
                    return '<tr><td><strong>' + t.name + '</strong><br>' + t.id + '</td><td>' + t.pw + '</td><td><button class="btn btn-delete btn-sm" onclick="deleteUser(\'' + t.id + '\')">ì‚­ì œ</button></td></tr>';
                }).join('');
            }

            // í•™ìƒ ê´€ë¦¬
            var students = users.filter(function(u) { return u.type === 'í•™ìƒ'; });
            var filtered = students.filter(function(u) {
                var matchT = (userRole === 'admin') ? (filterValue === 'all' || u.teacher === filterValue) : (u.teacher === loginName);
                var matchS = u.name.toLowerCase().includes(search);
                return matchT && matchS;
            });

            document.getElementById('user-count').innerText = filtered.length + "ëª…";
            document.getElementById('user-list-body').innerHTML = filtered.map(function(user) {
                return '<tr>' +
                    '<td><strong>' + user.name + '</strong><br>' + user.id + '</td>' +
                    '<td><button class="btn btn-blue btn-sm" onclick="showDetail(\'' + user.id + '\')">ê¸°ë¡</button></td>' +
                    '<td>Lv.' + (user.level || 1) + '</td>' +
                    '<td style="color:#facc15">' + (user.teacher || '-') + '</td>' +
                    '<td><button class="btn btn-delete btn-sm" onclick="deleteUser(\'' + user.id + '\')">ì‚­ì œ</button></td>' +
                '</tr>';
            }).join('');
        });
    }

    // [7] ê°€ì… ìŠ¹ì¸ ë¡œì§
    function loadJoinRequests() {
        db.ref('joinRequests').on('value', function(snapshot) {
            var data = snapshot.val();
            var list = document.getElementById('request-list');
            if(!list) return;
            if(!data) { list.innerHTML = "ìš”ì²­ ì—†ìŒ"; return; }
            var html = "";
            for(var id in data) {
                html += '<div style="display:flex; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.05); margin-bottom:5px; border-radius:8px;">' +
                        '<span>' + data[id].name + '(' + data[id].type + ')</span>' +
                        '<button class="btn btn-approve btn-sm" onclick="approveJoin(\'' + id + '\')">ìŠ¹ì¸</button></div>';
            }
            list.innerHTML = html;
        });
    }

    function approveJoin(id) {
        db.ref('joinRequests/' + id).once('value').then(function(snapshot) {
            if (snapshot.exists()) {
                var userData = snapshot.val();
                userData.level=1; userData.gems=0; userData.coins=0; userData.bestScores={}; userData.badges=""; userData.practiceLogs=[];
                db.ref('approvedUsers/' + id).set(userData);
                db.ref('joinRequests/' + id).remove();
                alert("ìŠ¹ì¸ ì™„ë£Œ!");
            }
        });
    }

    // [8] ì´ˆê¸°í™” ë²„íŠ¼ (ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„)
    function resetRank(subject) {
        if(confirm(subject + "ì˜ ì‹¤ì‹œê°„ ìˆœìœ„íŒì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            var keyMap = { 
                'ì•”ì‚°ì±”í”¼ì–¸':'rank_championship', 'ë§ì…ˆì´ˆê¸‰':'rank_add_base', 'ë§ì…ˆì¤‘ê¸‰':'rank_add_medium', 
                'ë§ì…ˆë§ˆìŠ¤í„°':'rank_add_master', '10ë§Œë“¤ê¸°':'rank_make10', '24ë§Œë“¤ê¸°':'rank_make24', 'ìŠíƒœí‘œ':'rank_schulte',
                'ê³±ì…ˆì´ˆê¸‰':'rank_mul_base', 'ê³±ì…ˆì¤‘ê¸‰':'rank_mul_medium', 'ê³±ì…ˆë§ˆìŠ¤í„°':'rank_mul_master',
                'ë‚˜ëˆ—ì…ˆì´ˆê¸‰':'rank_div_base', 'ë‚˜ëˆ—ì…ˆì¤‘ê¸‰':'rank_div_medium', 'ë‚˜ëˆ—ì…ˆë§ˆìŠ¤í„°':'rank_div_master'
            };
            if(subject === 'ì „ì²´ëŒ€íšŒ') {
                db.ref('rankings').remove().then(function() { alert("ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ"); });
            } else if(keyMap[subject]) {
                db.ref('rankings/' + keyMap[subject]).remove().then(function() { alert(subject + " ì´ˆê¸°í™” ì™„ë£Œ"); });
            }
        }
    }

    // [9] ê¸°íƒ€ í•¨ìˆ˜
    function directRegister() {
        var name = document.getElementById('reg-name').value;
        var id = document.getElementById('reg-id').value;
        var pw = document.getElementById('reg-pw').value;
        var type = document.getElementById('reg-type').value;
        var teacher = document.getElementById('reg-teacher-select').value;
        if (userRole !== 'admin') { type = "í•™ìƒ"; teacher = loginName; }
        if(!name || !id || !pw) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        db.ref('approvedUsers/' + id).set({ name:name, id:id, pw:pw, type:type, teacher:teacher, level: 1, gems: 0, coins: 0, bestScores: {}, badges: "", practiceLogs: [] })
        .then(function() { alert("ë“±ë¡ ì™„ë£Œ!"); });
    }

    function deleteUser(id) { if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) db.ref('approvedUsers/' + id).remove(); }
    
    function showDetail(id) {
        db.ref('approvedUsers/' + id).once('value').then(function(snapshot) {
            var user = snapshot.val();
            if(!user) return;
            document.getElementById('modal-user-name').innerText = "ğŸ“Š " + user.name + " í•™ìƒ ë¦¬í¬íŠ¸";
            document.getElementById('m-gem').innerText = user.gems || 0;
            document.getElementById('m-coin').innerText = user.coins || 0;
            document.getElementById('m-badges').innerText = user.badges || "ì—†ìŒ";
            var best = user.bestScores || {};
            var html1 = ""; var html2 = "";
            group1.forEach(function(sub) { html1 += '<div class="subject-card"><span>'+sub+'</span><span class="score-val">'+(best[sub]||'-')+'</span></div>'; });
            group2.forEach(function(sub) { html2 += '<div class="subject-card"><span>'+sub+'</span><span class="score-val">'+(best[sub]||'-')+'</span></div>'; });
            document.getElementById('col-1').innerHTML = html1;
            document.getElementById('col-2').innerHTML = html2;
            document.getElementById('record-modal').style.display = 'flex';
        });
    }
    function closeModal() { document.getElementById('record-modal').style.display = 'none'; }
    window.onclick = function(e) { if (e.target == document.getElementById('record-modal')) closeModal(); }


function loadAllStudentRecords() {
    const displayArea = document.getElementById('admin-record-list');
    // ë¡œë”© ì¤‘ì¼ ë•Œ ë””ìì¸ì´ ê¹¨ì§€ì§€ ì•Šê²Œ ì•ˆë‚´ ë¬¸êµ¬ë§Œ ì‚´ì§ ë„ì›ë‹ˆë‹¤.
    displayArea.innerHTML = "<p style='color:#a855f7; grid-column: 1/-1;'>ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>";

    // ì„œë²„ì˜ 'users' ë°©ì„ ì½ì–´ì˜µë‹ˆë‹¤.
    firebase.database().ref('users').once('value', function(snapshot) {
        const users = snapshot.val();
        
        if (!users) {
            displayArea.innerHTML = "<p style='color:#94a3b8; grid-column: 1/-1;'>ì•„ì§ ìŒ“ì¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì•„ì´ë“¤ì´ ê²Œì„ì„ ëê¹Œì§€ ì™„ë£Œí•´ì•¼ ê¸°ë¡ì´ ìƒê¹ë‹ˆë‹¤.</p>";
            return;
        }

        let html = "";
        // ë°ì´í„°ë¥¼ í•˜ë‚˜ì”© êº¼ë‚´ì„œ ì„ ìƒë‹˜ì˜ ë””ìì¸ ë°”êµ¬ë‹ˆì— ë‹´ìŠµë‹ˆë‹¤.
        for (let id in users) {
            const u = users[id];
            
            // ì„ ìƒë‹˜ì´ ë§Œë“œì‹  ë””ìì¸ ê·¸ëŒ€ë¡œ ìœ ì§€ (ìˆ˜ì • ê¸ˆì§€ ì˜ì—­)
            html += `
                <div class="student-record-card" style="background: rgba(0,0,0,0.3); border: 1px solid #a855f7; padding: 15px; border-radius: 12px; text-align: left;">
                    <div style="border-bottom: 1px solid rgba(168, 85, 247, 0.3); padding-bottom: 8px; margin-bottom: 10px;">
                        <strong style="font-size: 1.1rem; color: #d8b4fe;">${u.name || 'ì´ë¦„ì—†ìŒ'}</strong> 
                        <span style="font-size: 0.8rem; color: #94a3b8;">(${id})</span>
                    </div>
                    <div style="font-size: 0.9rem; color: #eee; line-height: 1.6;">
                        <div>ğŸ’ ë³´ì„: <strong>${u.gems || 0}ê°œ</strong></div>
                        <div>ğŸª™ ì½”ì¸: <strong>${u.coins || 0}ì›</strong></div>
                        <div>ğŸ† ìµœê³ ì : <strong>${u.bestScore || 0}ì </strong></div>
                        <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 5px;">ğŸ“… ìµœê·¼: ${u.lastDate || '-'}</div>
                    </div>
                </div>`;
        }
        displayArea.innerHTML = html;
    });
}




</script>
</body>
</html>
